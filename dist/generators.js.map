{"version":3,"sources":["src/generators.js"],"names":[],"mappings":";;;;;;;;;iBAsBU,IAAI,EAgCJ,UAAU,EAgCV,WAAW,EAyBX,SAAS,EAST,IAAI,EASJ,GAAG,EA0BH,OAAO,EAsBP,MAAM,EAiBN,WAAW,EAcX,eAAe,EASf,eAAe,EAOf,kBAAkB,EAQlB,kBAAkB,EAQlB,QAAQ;AAhPlB,IAAI,QAAQ,GAAG,SAAQ,CAAC;;QAGtB,SAAS,GAAT,SAAS;QACI,GAAG,GAAhB,SAAS;QACT,IAAI,GAAJ,IAAI;QACJ,eAAe,GAAf,eAAe;QACf,eAAe,GAAf,eAAe;QACf,kBAAkB,GAAlB,kBAAkB;QAClB,kBAAkB,GAAlB,kBAAkB;QAClB,WAAW,GAAX,WAAW;QACX,OAAO,GAAP,OAAO;QACP,IAAI,GAAJ,IAAI;QACJ,UAAU,GAAV,UAAU;QACV,MAAM,GAAN,MAAM;QACN,OAAO,GAAP,OAAO;QACP,QAAQ,GAAR,QAAQ;QACR,IAAI,GAAJ,IAAI;QACJ,GAAG,GAAH,GAAG;QACH,QAAQ,GAAR,QAAQ;;AAGV,SAAU,IAAI,CAAC,CAAC;MACV,CAAC,EACD,IAAI,EAaF,MAAM,EAMJ,KAAK;;;;AApBT,SAAC,GAAG,EAAE,EACN,IAAI,GAAG,CAAC;;;aAGN,IAAI;;;;;AACJ,cAAM,GAAG,CAAC,CAAC,IAAI,EAAE;;YAChB,MAAM,CAAC,IAAI;;;;;AACd,SAAC,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;;eACf,MAAM,CAAC,KAAK;;;;;;;;;;;;;;aAKf,IAAI;;;;;AACL,cAAM,GAAG,CAAC,CAAC,IAAI,EAAE;;YAChB,MAAM,CAAC,IAAI;;;;;AACd,SAAC,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;;eACf,MAAM,CAAC,KAAK;;;;;;;AAGd,aAAK,GAAG,CAAC,CAAC,IAAI,CAAC;;eACb,KAAK;;;AACX,YAAI,GAAG,CAAC,IAAI,GAAG,CAAC,CAAA,GAAI,CAAC,CAAC,MAAM,CAAC;;;;;;;;;;;CAGlC;;;;;AAMD,SAAU,UAAU,CAAC,UAAU;MACzB,CAAC,EACD,IAAI,EAIF,SAAS,EACT,MAAM,EAYH,MAAM;;;;AAAN,cAAM,YAAN,MAAM,CAAC,GAAG,EAAE;AACnB,cAAI,KAAK,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AAC3B,cAAI,KAAK,IAAI,CAAC,CAAC,EAAE;AACf,aAAC,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;AACnB,gBAAI,IAAI,IAAI,KAAK,EAAE;AACjB,kBAAI,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,GAAG,CAAC,CAAC;aAC5C;WACF,MACI,MAAM,KAAK,CAAC,yCAAyC,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;SACrE;;AA3BG,SAAC,GAAG,OAAO,CAAC,UAAU,CAAC,EACvB,IAAI,GAAG,CAAC;;;cAEL,CAAC,CAAC,MAAM,GAAG,CAAC,CAAA;;;;;AACjB,YAAI,GAAG,IAAI,GAAG,CAAC,CAAC,MAAM,CAAC;AACnB,iBAAS,GAAG,CAAC,CAAC,IAAI,CAAC,EACnB,MAAM,GAAG,SAAS,CAAC,IAAI,EAAE;;aAEzB,MAAM,CAAC,IAAI;;;;;AACb,cAAM,CAAC,SAAS,CAAC,CAAC;;cACd,CAAC,CAAC,MAAM,IAAI,CAAC,CAAA;;;;;4CAAS,MAAM,CAAC,KAAK;;;;AAGxC,YAAI,GAAG,IAAI,GAAG,CAAC,CAAC;;;eAEV,MAAM,CAAC,KAAK;;;;;;;;;;;CAarB;;AAGD,SAAU,WAAW,CAAC,UAAU,EAAE,KAAK;MAE/B,MAAM,EACN,SAAS;;;;AAFf,eAAO,IAAI,EAAE;AACP,gBAAM,GAAG,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,EAC/B,SAAS,GAAG,MAAM,CAAC,KAAK;SAE7B;;;;;;;CACF;;AAED,SAAS,YAAY,CAAC,CAAC,EAAE,EAAE,EAAE;AAC3B,MAAI,MAAM,GAAG,EAAE,CAAC;AAChB,SAAO,IAAI,EAAE;AACX,QAAI,MAAM,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;AACtB,UAAM,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;AAC9B,QAAI,MAAM,CAAC,IAAI;AAAE,aAAO,MAAM,CAAC;KAAA;GAChC;CACF;;AAED,SAAS,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE;AACnB,SAAO,IAAI,EAAE;AACX,QAAI,MAAM,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;AACtB,MAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACjB,QAAI,MAAM,CAAC,IAAI;AAAE,aAAO;KAAA;GACzB;CACF;;AAED,SAAU,SAAS,CAAC,SAAS,EAAE,EAAE;uBAExB,KAAK,EAAE,IAAI;;;;;aADX,IAAI;;;;;0BACW,SAAS,CAAC,IAAI,EAAE;AAA/B,aAAK,mBAAL,KAAK;AAAE,YAAI,mBAAJ,IAAI;;aAEZ,IAAI;;;;;4CAAS,KAAK,IAAI,QAAQ,GAAG,QAAQ,GAAG,EAAE,CAAC,KAAK,CAAC;;;;eAC9C,EAAE,CAAC,KAAK,CAAC;;;;;;;;;;;CAEvB;;AAED,SAAU,IAAI,CAAC,SAAS,EAAE,KAAK;MAEvB,MAAM;;;;aADL,IAAI;;;;;AACL,cAAM,GAAG,SAAS,CAAC,IAAI,EAAE;;cACzB,MAAM,CAAC,IAAI,IAAI,EAAE,KAAK,IAAI,CAAC,CAAA;;;;;4CAAS,MAAM,CAAC,KAAK;;;;eAC9C,MAAM,CAAC,KAAK;;;;;;;;;;;CAErB;;;AAGD,SAAU,GAAG,CAAC,UAAU;MAClB,KAAK,EAEL,SAAS,EAEP,OAAO,EACF,CAAC,EACJ,SAAS,EACT,MAAM;;;;AAPV,aAAK,GAAG,OAAO,CAAC,UAAU,CAAC;AAE3B,iBAAS,GAAG,KAAK,CAAC,MAAM;;;cACrB,SAAS,GAAG,CAAC,CAAA;;;;;AACd,eAAO,GAAG,EAAE;;AAChB,aAAS,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACjC,mBAAS,GAAG,KAAK,CAAC,CAAC,CAAC,EACpB,MAAM,GAAG,SAAS,IAAI,IAAI,GAAG,SAAS,CAAC,IAAI,EAAE,GAAG,SAAS;;AAE7D,cAAI,MAAM,EAAE;AACV,mBAAO,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AAC3B,gBAAI,MAAM,CAAC,IAAI,EAAE;AACf,qBAAO,KAAK,CAAC,CAAC,CAAC,CAAC;AAChB,uBAAS,EAAE,CAAC;aACb;WACF,MACI,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SAC9B;;cAEG,SAAS,IAAI,CAAC,CAAA;;;;;4CAAS,OAAO;;;;eAC5B,OAAO;;;;;;;;;;;CAEhB;;;AAGD,SAAU,OAAO,CAAC,SAAS,EAAE,KAAK;MAC5B,MAAM,EAaD,CAAC;;;;AAbN,cAAM,GAAG,EAAE;;wCAET;cAEE,MAAM;;;;qBADN,IAAI;;;;;AACJ,sBAAM,GAAG,SAAS,CAAC,IAAI,EAAE;;AAC7B,uBAAO,CAAC,GAAG,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;AAClC,sBAAM,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;;qBAEtB,MAAM,CAAC,IAAI;;;;;oDAAS,MAAM,CAAC,KAAK;;;;uBACzB,MAAM,CAAC,KAAK;;;;;;;;;;;SAE1B;;;AAEQ,SAAC,GAAG,CAAC;;;cAAE,CAAC,GAAG,KAAK,GAAG,CAAC,CAAA;;;;;;wCACrB;cACK,CAAC;;;;AAAD,iBAAC,GAAG,CAAC;;;sBAAE,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,CAAA;;;;;;uBAAa,MAAM,CAAC,CAAC,CAAC;;;AAApB,iBAAC,EAAE;;;;;oDACnC,MAAM,CAAC,CAAC,CAAC;;;;;;;SACjB;;;AAJ4B,SAAC,EAAE;;;;;;;;;CAMnC;;AAED,SAAU,MAAM,CAAC,IAAI,EAAE,KAAK;MAGjB,CAAC;;;;cAFN,KAAK,IAAI,CAAC,CAAA;;;;;cAAQ,IAAI,KAAK,CAAC,sBAAsB,CAAC;;;AAE9C,SAAC,GAAG,CAAC;;;cAAE,CAAC,GAAG,KAAK,GAAG,CAAC,CAAA;;;;;;eAAa,IAAI;;;AAAf,SAAC,EAAE;;;;;4CAC3B,IAAI;;;;;;;CACZ;;AAED,SAAS,OAAO,CAAC,SAAS,EAAE;AAC1B,MAAI,KAAK,GAAG,EAAE,CAAC;;AAEf,SAAO,IAAI,EAAE;2BACS,SAAS,CAAC,IAAI,EAAE;;QAA/B,KAAK,oBAAL,KAAK;QAAE,IAAI,oBAAJ,IAAI;;AAChB,QAAI,KAAK,IAAI,QAAQ,EAAE,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AACzC,QAAI,IAAI;AAAE,aAAO,KAAK,CAAC;KAAA;GACxB;CACF;;AAED,SAAU,WAAW,CAAC,KAAK;MACrB,MAAM,EAKD,CAAC;;;;AALN,cAAM,GAAG,KAAK,CAAC,MAAM;;cAErB,MAAM,IAAI,CAAC,CAAA;;;;;cAAQ,KAAK,CAAC,yBAAyB,CAAC;;;AAG9C,SAAC,GAAG,CAAC;;;cAAE,CAAC,GAAG,MAAM,GAAG,CAAC,CAAA;;;;;;eACtB,KAAK,CAAC,CAAC,CAAC;;;AADgB,SAAC,EAAE;;;;;4CAG5B,KAAK,CAAC,CAAC,CAAC;;;;;;;CAChB;;;;AAID,SAAU,eAAe,CAAC,KAAK;;;;cACzB,KAAK,CAAC,MAAM,IAAI,CAAC,CAAA;;;;;cAAQ,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC;;;cAEjD,KAAK,CAAC,MAAM,GAAG,CAAC,CAAA;;;;;;eAAQ,KAAK,CAAC,GAAG,EAAE;;;;;;;4CACnC,KAAK,CAAC,GAAG,EAAE;;;;;;;CACnB;;;;AAID,SAAU,eAAe,CAAC,KAAK;;;;cACzB,KAAK,CAAC,MAAM,IAAI,CAAC,CAAA;;;;;cAAQ,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC;;;cAEjD,KAAK,CAAC,MAAM,GAAG,CAAC,CAAA;;;;;;eAAQ,KAAK,CAAC,KAAK,EAAE;;;;;;;4CACrC,KAAK,CAAC,KAAK,EAAE;;;;;;;CACrB;;AAED,SAAU,kBAAkB,CAAC,KAAK;;;;cAC5B,KAAK,CAAC,MAAM,IAAI,CAAC,CAAA;;;;;cAAQ,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC;;;;eAE7C,KAAK,CAAC,GAAG,EAAE;;;YAAW,KAAK,CAAC,MAAM,GAAG,CAAC;;;;;;4CAE1C,QAAQ;;;;;;;CAChB;;AAED,SAAU,kBAAkB,CAAC,KAAK;;;;cAC5B,KAAK,CAAC,MAAM,IAAI,CAAC,CAAA;;;;;cAAQ,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC;;;;eAE7C,KAAK,CAAC,KAAK,EAAE;;;YAAW,KAAK,CAAC,MAAM,GAAG,CAAC;;;;;;4CAE5C,QAAQ;;;;;;;CAChB;;AAED,SAAU,QAAQ,CAAC,KAAK,EAAE,GAAG;MAOvB,CAAC;;;;cAND,GAAG,IAAI,SAAS,CAAA;;;;;AACd,SAAC,GAAG,KAAK,IAAI,CAAC;;;cACX,CAAC,GAAG,GAAG,CAAA;;;;;;eAAQ,CAAC,EAAE;;;;;;;4CAClB,CAAC;;;AAGN,SAAC,GAAG,KAAK,IAAI,CAAC;;;aACX,IAAI;;;;;;eAAQ,CAAC,EAAE;;;;;;;;;;;CACvB","file":"src/generators.js","sourcesContent":["let TERMINAL = Symbol();\n\nexport {\n  transform,\n  transform as map,\n  each,\n  modifiableStack,\n  modifiableQueue,\n  modifiableStackAlt,\n  modifiableQueueAlt,\n  toGenerator,\n  toArray,\n  loop,\n  interleave,\n  repeat,\n  repeatG,\n  integers,\n  take,\n  zip,\n  TERMINAL\n};\n\nfunction* loop(g) {\n  var q = [],\n      next = 0;\n\n  var result;\n  while(true) {\n    var result = g.next();\n    if (!result.done) {\n      q.push(result.value);\n      yield result.value;\n    }\n    else break;\n  }\n\n  while (true) {\n    var result = g.next();\n    if (!result.done) {\n      q.push(result.value);\n      yield result.value;\n    }\n    else {\n      var value = q[next];\n      yield value;\n      next = (next + 1) % q.length;\n    }\n  }\n}\n\n\n// Interleave the results of a series of generators\n//\n// `generators`: a generator that produces the generators to interleave\nfunction* interleave(generators) {\n  var q = toArray(generators),\n      next = 0;\n\n  while (q.length > 0) {\n    next = next % q.length;\n    var generator = q[next],\n        result = generator.next();\n\n    if (result.done) {\n      remove(generator);\n      if (q.length == 0) return result.value;\n    }\n\n    next = next + 1;\n\n    yield result.value;\n  }\n\n  function remove(obj) {\n    var index = q.indexOf(obj);\n    if (index != -1) {\n      q.splice(index, 1);\n      if (next >= index) {\n        next = next == 0 ? q.length - 1 : next - 1;\n      }\n    }\n    else throw Error('Tried to remove object that is not in q', obj, q);\n  }\n}\n\n\nfunction* threadValue(generators, value) {\n  while (true) {\n    var result = generators.next(value),\n        generator = result.value;\n\n  }\n}\n\nfunction mapGenerator(g, fn) {\n  var mapped = [];\n  while (true) {\n    var result = g.next();\n    mapped.push(fn(result.value));\n    if (result.done) return mapped;\n  }\n}\n\nfunction each(g, fn) {\n  while (true) {\n    var result = g.next();\n    fn(result.value);\n    if (result.done) return;\n  }\n}\n\nfunction* transform(generator, fn) {\n  while (true) {\n    var {value, done} = generator.next();\n\n    if (done) return value == TERMINAL ? TERMINAL : fn(value); // Do we want to embed this terminal logic here?\n    else yield fn(value);\n  }\n}\n\nfunction* take(generator, count) {\n  while (true) {\n    var result = generator.next();\n    if (result.done || --count <= 0) return result.value;\n    yield result.value;\n  }\n}\n\n//Shouldn't we be yielding generators?\nfunction* zip(generators) {\n  var array = toArray(generators);\n\n  var remaining = array.length;\n  while (remaining > 0) {\n    var product = [];\n    for (var i = 0; i < array.length; i++) {\n      var generator = array[i],\n          result = generator != null ? generator.next() : undefined;\n\n      if (result) {\n        product.push(result.value);\n        if (result.done) {\n          delete array[i];\n          remaining--;\n        }\n      }\n      else product.push(undefined);\n    }\n\n    if (remaining == 0) return product;\n    yield product;\n  }\n}\n\n// There are multiple ways to implement this function...\nfunction* repeatG(generator, count) {\n  var values = [];\n\n  yield function* () {\n    while(true) {\n      var result = generator.next();\n      console.log('got result', result);\n      values.push(result.value);\n\n      if (result.done) return result.value;\n      else yield result.value;\n    }\n  };\n\n  for (var i = 0; i < count - 1; i++) {\n    yield function* () {\n      for (var v = 0; v < values.length - 1; v++) yield values[v];\n      return values[v];\n    };\n  }\n}\n\nfunction* repeat(item, count) {\n  if (count == 0) throw new Error('why did you do that?');\n\n  for (var i = 0; i < count - 1; i++) yield item;\n  return item;\n}\n\nfunction toArray(generator) {\n  var array = [];\n\n  while (true) {\n    let {value, done} = generator.next();\n    if (value != TERMINAL) array.push(value);\n    if (done) return array;\n  }\n}\n\nfunction* toGenerator(array) {\n  var length = array.length;\n\n  if (length == 0) throw Error('What should we do here?');\n\n  // var i = 0;\n  for (var i = 0; i < length - 1; i++) {\n    yield array[i];\n  }\n  return array[i];\n}\n\n// if the stack is modified after popping the last element, the remaining\n// stack won't be generated...\nfunction* modifiableStack(stack) {\n  if (stack.length == 0) throw Error('Empty stack', stack);\n\n  while (stack.length > 1) yield stack.pop();\n  return stack.pop();\n}\n\n// if the queue is modified after popping the last element, the remaining\n// queue won't be generated...\nfunction* modifiableQueue(queue) {\n  if (queue.length == 0) throw Error('Empty queue', queue);\n\n  while (queue.length > 1) yield queue.shift();\n  return queue.shift();\n}\n\nfunction* modifiableStackAlt(stack) {\n  if (stack.length == 0) throw Error('Empty stack', stack);\n\n  do { yield stack.pop(); } while (stack.length > 0);\n\n  return TERMINAL;\n}\n\nfunction* modifiableQueueAlt(queue) {\n  if (queue.length == 0) throw Error('Empty queue', queue);\n\n  do { yield queue.shift(); } while (queue.length > 0);\n\n  return TERMINAL;\n}\n\nfunction* integers(start, end) {\n  if (end != undefined) {\n    var i = start || 0;\n    while (i < end) yield i++;\n    return i;\n  }\n\n  var i = start || 0;\n  while (true) yield i++;\n}"]}